<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Book Archive Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ë³€ìˆ˜ ì„¤ì •: ë¼ì´íŠ¸/ë‹¤í¬ ëª¨ë“œ ê³µìš© */
        :root {
            --primary: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f3f4f6;
            --card: #ffffff;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border: #d1d5db;
        }

        /* ë‹¤í¬ëª¨ë“œ ì „ìš© ë³€ìˆ˜ */
        [data-theme='dark'] {
            --bg: #111827;
            --card: #1f2937;
            --text-main: #f9fafb;
            --text-sub: #9ca3af;
            --border: #374151;
        }

        body {
            font-family: 'Pretendard', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0; padding: 20px;
            transition: background 0.3s, color 0.3s;
        }

        .container { max-width: 1100px; margin: 0 auto; }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        /* ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ */
        .theme-toggle {
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text-main);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card); padding: 20px;
            border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stat-card h3 { margin: 0; font-size: 0.9rem; color: var(--text-sub); }
        .stat-card p { margin: 10px 0 0; font-size: 1.8rem; font-weight: 800; color: var(--primary); }

        .chart-box {
            background: var(--card); padding: 20px;
            border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            grid-column: span 2; min-height: 250px;
        }

        .input-section {
            background: var(--card); padding: 25px;
            border-radius: 16px; margin-bottom: 30px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        .form-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;
        }

        .full-w { grid-column: 1 / -1; }
        label { font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; display: block; }
        input, select, textarea {
            width: 100%; padding: 10px; border: 1px solid var(--border);
            border-radius: 8px; box-sizing: border-box;
            background: var(--card); color: var(--text-main);
        }

        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button {
            flex: 1; padding: 12px; border: none; border-radius: 8px;
            font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .btn-save { background: var(--primary); color: white; }
        .btn-csv { background: var(--success); color: white; }

        .book-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px;
        }

        .book-card {
            background: var(--card); border-radius: 12px; display: flex;
            overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: relative;
            border: 1px solid var(--border);
        }

        .book-img { width: 100px; object-fit: cover; background: #e5e7eb; }
        .book-info { padding: 15px; flex: 1; }
        .status-badge {
            font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; font-weight: bold;
            margin-bottom: 5px; display: inline-block;
        }
        .status-reading { background: #fef3c7; color: #92400e; }
        .status-done { background: #d1fae5; color: #065f46; }

        .delete-btn {
            position: absolute; top: 10px; right: 10px; cursor: pointer;
            color: var(--text-sub); background: none; border: none; font-size: 1.2rem;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ“š Book Archive</h1>
        <button class="theme-toggle" id="themeBtn" onclick="toggleTheme()">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
    </header>

    <div class="stats-container">
        <div class="stat-card">
            <h3>ì „ì²´ ë„ì„œ</h3>
            <p id="totalCount">0</p>
        </div>
        <div class="stat-card">
            <h3>ì™„ë…</h3>
            <p id="doneCount" style="color: var(--success)">0</p>
        </div>
        <div class="chart-box">
            <canvas id="categoryChart"></canvas>
        </div>
    </div>

    <div class="input-section">
        <div class="form-grid">
            <div>
                <label>ì±… ì œëª©</label>
                <input type="text" id="title" placeholder="ì œëª©">
            </div>
            <div>
                <label>ì €ì</label>
                <input type="text" id="author" placeholder="ì €ì">
            </div>
            <div>
                <label>ì¹´í…Œê³ ë¦¬</label>
                <select id="category">
                    <option value="ê²½ì œ/ê²½ì˜">ê²½ì œ/ê²½ì˜</option>
                    <option value="IT/ë°ì´í„°">IT/ë°ì´í„°</option>
                    <option value="ìê¸°ê³„ë°œ">ìê¸°ê³„ë°œ</option>
                    <option value="ì†Œì„¤/ì—ì„¸ì´">ì†Œì„¤/ì—ì„¸ì´</option>
                </select>
            </div>
            <div>
                <label>ìƒíƒœ</label>
                <select id="status">
                    <option value="reading">ğŸ“– ì½ëŠ” ì¤‘</option>
                    <option value="done">âœ… ì™„ë…</option>
                </select>
            </div>
            <div>
                <label>ë³„ì </label>
                <select id="rating">
                    <option value="5">â­â­â­â­â­</option>
                    <option value="4">â­â­â­â­</option>
                    <option value="3">â­â­â­</option>
                    <option value="2">â­â­</option>
                    <option value="1">â­</option>
                </select>
            </div>
            <div class="full-w">
                <label>ë…¸íŠ¸</label>
                <textarea id="review" rows="2"></textarea>
            </div>
        </div>
        <div class="btn-group">
            <button class="btn-save" onclick="addBook()">ì €ì¥í•˜ê¸°</button>
            <button class="btn-csv" onclick="exportToCSV()">CSV ë‚´ë³´ë‚´ê¸°</button>
        </div>
    </div>

    <div class="book-grid" id="bookGrid"></div>
</div>

<script>
    let myChart = null;

    // 1. ë‹¤í¬ëª¨ë“œ ì´ˆê¸° ì„¤ì •
    const currentTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', currentTheme);
    updateThemeBtnText(currentTheme);

    function toggleTheme() {
        const target = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', target);
        localStorage.setItem('theme', target);
        updateThemeBtnText(target);
        render(); // ì°¨íŠ¸ ìƒ‰ìƒ ê°±ì‹ ì„ ìœ„í•´ ì¬ëœë”ë§
    }

    function updateThemeBtnText(theme) {
        document.getElementById('themeBtn').innerText = theme === 'dark' ? 'â˜€ï¸ ë¼ì´íŠ¸ëª¨ë“œ' : 'ğŸŒ™ ë‹¤í¬ëª¨ë“œ';
    }

    // 2. ë…ì„œ ê¸°ë¡ ë¡œì§
    document.addEventListener('DOMContentLoaded', render);

    function addBook() {
        const title = document.getElementById('title').value;
        const author = document.getElementById('author').value;
        if (!title || !author) return alert('ì œëª©ê³¼ ì €ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

        const book = {
            id: Date.now(),
            title, author,
            category: document.getElementById('category').value,
            status: document.getElementById('status').value,
            rating: document.getElementById('rating').value,
            review: document.getElementById('review').value,
            date: new Date().toLocaleDateString()
        };

        const books = JSON.parse(localStorage.getItem('books') || '[]');
        books.push(book);
        localStorage.setItem('books', JSON.stringify(books));
        
        document.querySelectorAll('input, textarea').forEach(el => el.value = '');
        render();
    }

    function deleteBook(id) {
        if (!confirm('ì‚­ì œí• ê¹Œìš”?')) return;
        const books = JSON.parse(localStorage.getItem('books') || '[]').filter(b => b.id !== id);
        localStorage.setItem('books', JSON.stringify(books));
        render();
    }

    function render() {
        const books = JSON.parse(localStorage.getItem('books') || '[]');
        updateStats(books);
        
        const grid = document.getElementById('bookGrid');
        grid.innerHTML = books.reverse().map(b => `
            <div class="book-card">
                <div class="book-info">
                    <span class="status-badge ${b.status === 'done' ? 'status-done' : 'status-reading'}">
                        ${b.status === 'done' ? 'ì™„ë…' : 'ì½ëŠ” ì¤‘'}
                    </span>
                    <div style="font-weight:bold; font-size:1.1rem; margin-bottom:4px;">${b.title}</div>
                    <div style="font-size:0.85rem; color:var(--text-sub);">${b.author} | ${b.category}</div>
                    <div style="color:var(--warning); font-size:0.8rem; margin:5px 0;">${'â­'.repeat(b.rating)}</div>
                    <div style="font-size:0.85rem;">${b.review}</div>
                </div>
                <button class="delete-btn" onclick="deleteBook(${b.id})">Ã—</button>
            </div>
        `).join('');
    }

    function updateStats(books) {
        document.getElementById('totalCount').innerText = books.length;
        document.getElementById('doneCount').innerText = books.filter(b => b.status === 'done').length;

        const catMap = {};
        books.forEach(b => catMap[b.category] = (catMap[b.category] || 0) + 1);

        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        const chartColor = isDark ? '#818cf8' : '#4f46e5';

        const ctx = document.getElementById('categoryChart').getContext('2d');
        if (myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(catMap),
                datasets: [{
                    label: 'ë¶„ì•¼ë³„ ë…ì„œëŸ‰',
                    data: Object.values(catMap),
                    backgroundColor: chartColor
                }]
            },
            options: {
                maintainAspectRatio: false,
                scales: {
                    y: { ticks: { color: isDark ? '#fff' : '#666' } },
                    x: { ticks: { color: isDark ? '#fff' : '#666' } }
                },
                plugins: { legend: { labels: { color: isDark ? '#fff' : '#666' } } }
            }
        });
    }

    function exportToCSV() {
        const books = JSON.parse(localStorage.getItem('books') || '[]');
        let csv = "\uFEFFë‚ ì§œ,ì œëª©,ì €ì,ì¹´í…Œê³ ë¦¬,ìƒíƒœ,ë³„ì ,ë©”ëª¨\n";
        books.forEach(b => {
            csv += `${b.date},${b.title},${b.author},${b.category},${b.status},${b.rating},"${b.review.replace(/"/g, '""')}"\n`;
        });
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "my_reading_history.csv";
        link.click();
    }
</script>

</body>
</html>